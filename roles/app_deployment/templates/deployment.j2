kind: Deployment
name: "{{ item.name }}"
api_version: "{{ item.api_version }}"
{% if item.labels is defined or item.annotations is defined %}
metadata:
  {% if item.labels is defined %}
  labels: "{{ item.labels }}"
  {% endif %}
  {% if item.annotations is defined %}
  annotations: "{{ item.annotations }}"
  {% endif %}
{% endif %}
spec:
  {% if item.replicas is defined %}
  replicas: "{{ item.replicas }}"
  {% endif %}
  {% if item.labels is defined %}
  selector:
    matchLabels: "{{ item.labels }}"
  {% endif %}
  {% if item.max_surge is defined or item.max_unavailable is defined %}
  strategy:
     rollingUpdate:
       maxSurge: "{{ item.max_surge }}"
       maxUnavailable: "{{ item.max_unavailable }}"
     type:  RollingUpdate
  {% endif %}
  template:
    {% if item.labels is defined %}
    metadata:
      labels: "{{ item.labels }}"
    {% endif %}
    {% if item.containers is defined %}
    spec:
      containers:
      {% for container in item.containers %}
      - name: "{{ container.name }}"
        image: "{{ container.image }}"
        {% if container.ports is defined %}
        {% for port in container.ports %}
        ports:
        - containerPort: "{{ port.containerPort }}"
        {% endfor %}
        {% endif %}
      {% endfor %}
    {% endif %}
